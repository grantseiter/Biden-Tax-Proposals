// ===========================================================#
// Title: "CG_death-rec"
// File_Author: "Grant M. Seiter -- American Enterprise Institute"
// Date: "September 2020"
// Notes: "Tax unrealized capital gains at death"
          "Input Variables: taxable_gains_at_death, gains_at_death"
// ===========================================================#

// records_variables.json

"taxable_gains_at_death": {
  "type": "float",
  "desc": "Imputed taxable portion of capital gains at death",
  "form": {"2021-20??": "imputed from JCT estimates in records.py"},
  "availability": "taxdata_puf"
},
"gains_at_death": {
  "type": "float",
  "desc": "Imputed capital gains at death",
  "form": {"2021-20??": "imputed from JCT estimates in records.py"},
  "availability": "taxdata_puf"
},

// records.py

if year >= 2021:
# create variables for capital gains at death
    # taxpayers' share of capital gains
    self.ltgains_weight = ((self.p23250 * self.s006) /
                           np.sum(self.p23250 * self.s006))
    self.ltgains_weight[self.p23250 > 0] = (
        (self.p23250[self.p23250 > 0] * self.s006[self.p23250 > 0])
        / np.sum(self.p23250[self.p23250 > 0] *
                 self.s006[self.p23250 > 0]))
    # assign total realization at death revenue to taxpayers based on ltgains_weight
    # NOTE: values in dictionary are the JCT Tax Expenditure for Exclusion at death for capital gains / EMTR on cap gains
    realization_at_death = {
        2021: 204253570343, 2022: 215627184994,
        2023: 226688939254, 2024: 235220544654,
        2025: 243736672365, 2026: 245533163473,
        2027: 254865207631, 2028: 264380671657,
        2029: 274178230759, 2030: 284077457991}
    self.gains_at_death = ((
        self.ltgains_weight * realization_at_death[year]) /
                           (self.s006))

    # remove local dictionary
    del gfv
